# NativeAndroidCamera (CameraX flash + video repro)

A tiny Android app generated by JUNIE to reproduce a CameraX bug that occurs when taking a still photo with flash ON while the video use case is also bound.


## Demo of the bug

https://github.com/user-attachments/assets/c4f54336-01b6-42db-9431-00e120290735

## Error

```
androidx.camera.core.ImageCaptureException: Capture request failed with reason ERROR
at androidx.camera.camera2.internal.Camera2CapturePipeline$Pipeline$2.onCaptureFailed(Camera2CapturePipeline.java:405
at androidx.camera.camera2.internal.CaptureCallbackAdapter.onCaptureFailed(CaptureCallbackAdapter.java:104)
at androidx.camera.camera2.internal.CameraBurstCaptureCallback.onCaptureFailed(CameraBurstCaptureCallback.java:75)
at android.hardware.camera2.impl.CameraCaptureSessionImpl$1.lambda$onCaptureFailed$5(CameraCaptureSessionImpl.java:722)
at android.hardware.camera2.impl.CameraCaptureSessionImpl$1.$r8$lambda$Ydhh2FrZkp7a6vW9ZdpZg9oABIk(Unknown Source:0)
at android.hardware.camera2.impl.CameraCaptureSessionImpl$1$$ExternalSyntheticLambda7.run(Unknown Source:8)
at androidx.camera.core.impl.utils.executor.SequentialExecutor$QueueWorker.workOnQueue(SequentialExecutor.java:229)
at androidx.camera.core.impl.utils.executor.SequentialExecutor$QueueWorker.run(SequentialExecutor.java:171)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1156)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:651)
at androidx.camera.core.CameraExecutor$1.lambda$newThread$0(CameraExecutor.java:68)
at androidx.camera.core.CameraExecutor$1$$ExternalSyntheticLambda0.run(D8$$SyntheticClass:0)
```

## What it does
- Fullscreen camera preview (CameraX + Camera2 backend) using Compose.
- A single "Shoot" button at the bottom.
- Captures an image with flash forced ON.
- Binds the VideoCapture use case (not used) to mirror real setups where video is enabled.
- Shows an alert with success/failure after capture; image is not saved.

## Why this app
It’s a minimal, focused repro for issues observed when:
- ImageCapture is set to FLASH_MODE_ON, and
- VideoCapture use case is also bound to the lifecycle.

## Build & Run
1. Open the project in Android Studio.
2. Sync Gradle and build.
3. Run on a physical device (recommended over emulator).
4. Grant Camera and Microphone permissions when prompted.

## Reproduce steps
1. Launch the app; you’ll see a fullscreen camera preview.
2. Tap “Shoot”.
3. Observe the alert dialog indicating success or failure.
   - Flash is forced to fire during capture.
   - Video use case is bound in the background to surface potential conflicts.

## Notes
- No media files are written to storage; this app is for behavior/bug reproduction only.
- Relevant log tag: "CameraScreen".
- Uses CameraX: Preview, ImageCapture, and VideoCapture.

## Tech stack
- Kotlin, Jetpack Compose, Material3.
- CameraX (camera-core, camera2, lifecycle, view, video).

